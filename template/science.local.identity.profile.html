<!DOCTYPE html>
#*
The server renders this HTML page in an end-user's browser when
needed authentication credentials may be obtained via HTTP Basic
Authentication or an HTML form.

Velocity variables (identified by the $ character) are generated
at runtime by the server.

The following variables are available on this page, but not used by default:

$hiddenFieldValues - A map of hidden field IDs to their values.

It is recommended to sanitize the values that are displayed using
$escape.escape() for example $escape.escape($hiddenFieldValues.get(0)).

Change text or formatting as needed. Modifying Velocity statements
is not recommended as it may interfere with expected server behavior.
*#

<!-- template name: science.local.identity.profile.html -->

#set( $messageKeyPrefix = "local.identity.profile." )

<html lang="$locale.getLanguage()" dir="ltr">
<head>
    <title>$templateMessages.getMessage($messageKeyPrefix, "title")</title>
    <base href="$CurrentPingFedBaseURL"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <link rel="stylesheet" type="text/css" href="assets/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/custom.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/ror.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/registration-help.css" />
    <script src='assets/scripts/ror.js'></script>
    <script src='assets/scripts/registration-help.js'></script>
</head>

<div id="privacyStatementOverlay">
    <div id="pablock">
    <div id="paheader">
        Privacy agreement
    </div>
    <div id="pacontent">
        <h2 >1. INTRODUCTION</h2>
        <p>The European Spallation Source ERIC (ESS) takes the privacy rights of individuals very seriously. ESS complies with personal data laws (GDPR) by keeping your personal data up-to-date, protecting your information from loss, misuse, unauthorised access and disclosure by ensuring appropriate technical measures are in place.</p>
        <h2>2.  WHAT PERSONAL DATA WILL YOU PROCESS?</h2>
        <p>For the purposes of registering for an ESS IT system account and basic site access, ESS will obtain and process the following personal data from you:</p>
        <ul class="privacylist">
            <li class="privacylist">Full name</li>
            <li class="privacylist">Contact information</li>
            <li class="privacylist">Organizational affiliation / employer</li>
        </ul>
        <p>For the purpose of registering for access to the ESS construction site, ESS will also obtain and process the additional personal data from you:</p>
        <ul class="privacylist">
            <li class="privacylist">Citizenship</li>
            <li class="privacylist">Date of birth</li>
            <li class="privacylist">Employment information</li>
            <li class="privacylist">Next of kin information</li>
        </ul>
        <p>ESS may additionally process your online identifiers (e.g. user credentials, IP address) each time you access an ESS IT system.</p>
		<h2>3.  HOW WILL YOU USE MY INFORMATION?</h2>
        <p>Your information will be used primarily to provide a system account for access to ESS IT systems and ESS site access. Your information will also be used for account management or work-related communication, to assist you with technical support, and to verify your identity. If you are performing work on the ESS construction site, your information will also be used to verify your right to work in Sweden and to notify your next of kin contacts in the case of an emergency. We reserve the right to use your personal data in order to fulfil legal, contractual, or similar obligations placed upon ESS.</p>
        <h2>4.  WILL MY PERSONAL DATA BE SENT TO COUNTRIES OUTSIDE THE EEA?</h2>
        No. ESS will not send your personal information outside the European Economic Area (EEA).</p>
        <h2>5.  WHY ARE YOU ALLOWED TO USE MY PERSONAL DATA?</h2>
        <p>ESS needs to collect and use your personal data because such processing is necessary to create IT system accounts and manage site access, and for individuals who may not be subject to a contract, due to legitimate business interests in ensuring only those individuals who are authorised may receive site access or create an IT system account. </p>
        <p>Additionally, ESS logs online identifiers of users in order to perform its security and technical support function. User activity is logged to ensure the security of ESS IT systems and to detect unauthorised access.</p>
        <h2>6.  HOW LONG IS MY PERSONAL DATA STORED?</h2>
        <p>ESS will collect, transfer, categorise, store, add to, and edit your personal information for the period of your work or business relationship, and period of site access validity, plus an additional period of up to 3 years thereafter.</p>
        <p>If associated with records which have a longer legal or regulatory retention period, your basic identification data (e.g. name, affiliation) will be retained to comply with the legally required retention period of the associated records.</p>
        <h2>7.  WHAT RIGHTS DO I HAVE?</h2>
        <p>Unless subject to an exception, you have:</p>
        <ul class="privacylist">
            <li class="privacylist">The right to request a copy of your personal data held by ESS;
            <li class="privacylist">The right to request ESS transmit your personal data to another data controller/entity; </li>
            <li class="privacylist">The right to request ESS correct any personal data if it is found to be inaccurate or out-of-date; </li>
            <li class="privacylist">The right to request your personal data be erased when it is no longer necessary for ESS to retain such data; </li>
            <li class="privacylist">The right to request a restriction on further processing when there is a dispute over the accuracy of personal data stored;</li>
            <li class="privacylist">The right to lodge a complaint with the Swedish Authority for Privacy Protection (Svensk: Integritetsskyddsmyndigheten - IMY).</li>
        </ul>
        <h2>8.  WHO CAN I CONTACT?</h2>
        <p>You may submit questions or exercise your rights by e-mail to privacy@ess.eu.</p>
        <h2>9.  WHO ELSE CAN I CONTACT?</h2>
        <p>If you believe there has been a violation of your personal data protection rights, you may e-mail privacy@ess.eu to discuss a solution.</p>
        <p>At any time, you have the right to communicate directly with the Swedish Authority for Privacy Protection (Svensk: Integritetsskyddsmyndigheten - IMY) at:</p>

        Integritetsskyddsmyndigheten (IMY)<br>
        Box 8114<br>
        104 20 Stockholm<br>
        Telefon: 08-657 61 00<br>
        E-post: imy@imy.se <br>
      </div>
	        <div id="pafooter">
          <a onclick="hidePrivacyStatement()">Close</a>
     <!--     |
          <a onclick="rejectPrivacyStatement()">Reject</a> -->
      </div>
    </div>
  </div>

<body class="columns-layout" onload="isWebAuthnPlatformAuthenticatorAvailable();">

#if($messages)
<div data-id="messages" class="page-messages full">
    #if($success)
    <div class="message show success" style="display: none">
        $templateMessages.getMessage($messageKeyPrefix, "success")<a class="close"></a>
    </div>
    #end
    #foreach ($message in $messages.getBannerMessages())
    <div class="message show $message.getCssString()" style="display: none">
        $templateMessages.getMessage($message.getMessageKey(), $message.getParams())<a class="close"></a>
    </div>
    #end
</div>
#end

<div class="ping-container ping-signin">
    <div class="ping-body-container">
        <div> 
            
            <form method="POST" action="$url" autocomplete="off">
                <!--<div class="ping-header has-logo">
                    <span class="company-logo"><img src="assets/images/esslogo.png"/></span>
                    $templateMessages.getMessage($messageKeyPrefix, "title")
                </div>-->
                    <span class="company-logo"><img src="assets/images/esslogo.png"/></span>
                <div class="account-title">
                    $templateMessages.getMessage($messageKeyPrefix, "title")
                </div>

                <div class="ping-messages">
                    #if($messages)
                        #foreach ($errorMessage in $messages.getStandardMessages())
                            <div class="ping-error">
                                $templateMessages.getMessage($errorMessage.getMessageKey(), $errorMessage.getParams())
                            </div>
                        #end
                    #end
                </div>
                <div class="ping-messages">
                    <div class="ping-error" style="display:none" id="required-field-error">
                        <span class="icon-alert"></span>
                        $templateMessages.getMessage($messageKeyPrefix, "required.fields.missing")
                    </div>
                </div>

                #if($isDisplaySendEmailButton)
                <div data-id="notice-message-button" class="inline-message notice full-width">
                    <input type="hidden" name="$sendEmailVerification" value=""/>
                    <div class="inline-message-text">$templateMessages.getMessage($messageKeyPrefix, "verifyEmailAddress")</div>
                    <div class="inline-message-btn">
                        <button type="button" class="inline" onclick="postSendEmailVerification();">
                            $templateMessages.getMessage($messageKeyPrefix, "sendEmailVerificationButtonTitle")
                        </button>
                    </div>
                </div>
                #end

                <!-- <div class="sections"> -->
                   <!-- <div class="section"> -->

             <!--           <div class="section-title">
                            $templateMessages.getMessage($messageKeyPrefix, "generalSettings")
                        </div> -->
                        #foreach ($field in $fields)
                        #set( $count = $velocityCount % 2)
                        #set( $fieldId = $field.getData().getId() )
                        #set( $escapedFieldId = $escape.escape($fieldId) )
                        #set( $fieldValue = $escape.escape($populateValues.get($fieldId)) )
                        #set( $required = "" )
                        #set( $validateRequired = "" )
                        #if( $field.isRequired())
                            #set ($required = "required" )
                            #set ($validateRequired = "required-missing-display" )
                        #end
                        #set( $fieldDisabled = "" )
                        #if( $field.isReadOnly() )
                            #set ($fieldDisabled = "disabled")
                        #end
                        #if( $field.getName() == "Checkbox Group" )
                            #set( $fieldValue = $populateValues.get($fieldId) )
                        #end
                        #set( $disabledSelect = "" )
                        #if( $field.getName() == "Dropdown" && $field.isRequired() )
                            #set( $disabledSelect = "disabled" )
                        ## Overwrite the required attribute if there was a default value for a dropdown.
                        #if( !$field.getData().getDefaultValue().equals("") )
                            #set( $required = "" )
                        #end
                        ## Override required if there is already a value that is a valid option.
                        #if( $fieldValue && $field.getData().getOptions().contains($fieldValue) )
                            #set( $required = "" )
                        #end
                        #end

                        #if($count == 1)
                        <!-- <div class="content-columns columns-2"> -->
                            #end
                            <!-- <div class="content-column"> -->

                                #if( $field.getName() == "Date" )
                                <div class="ping-input-label input-label">
                                    $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                </div>
                                <div class="ping-input-container $required" id="container-$escapedFieldId">
                                    <input class="$required $validateRequired" id="$escapedFieldId" type="date" name="$escapedFieldId" value="$fieldValue" placeholder="yyyy-mm-dd" onchange="return postOnReturn(event)" $fieldDisabled/>
                                </div>

                                #elseif( $field.getName() == "Text" )
                                <div class="ping-input-label">
                                    $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                </div>
                                #if($fieldId == $emailVerifyFieldId)
                                <div class="ping-input-container input-controls $required" id="container-$escapedFieldId">
                                    <div class="inline-confirmation">
                                        <div class="icon-approve" id="icon-email-verification"></div>
                                        <div class="confirmation-text" id="email-verification-text">$templateMessages.getMessage($messageKeyPrefix, "emailAddressVerified")</div>
                                    </div>
                                #else
                                <div class="ping-input-container $required" id="container-$escapedFieldId">
                                    #end
                                    <input class="$required $validateRequired" id="$escapedFieldId" type="text" autocomplete="off" name="$escapedFieldId" value="$fieldValue" onKeyPress="return postOnReturn(event)" $fieldDisabled/>
                                </div>


                                #elseif( $field.getName() == "Checkbox" )
                                <div class="error-text ping-alert" id="required-$escapedFieldId">
                                    <span class="icon-alert"></span>
                                    $templateMessages.getMessage($messageKeyPrefix, "missingCheckbox")
                                </div>
                                <label class="ping-input-container">
                                    <div class="ping-checkbox-container stacked $required" id="container-$escapedFieldId">
                                        #if( $fieldValue.equalsIgnoreCase("true") || $fieldValue.equalsIgnoreCase("on") )
                                        <input class="$required" id="$escapedFieldId" type="checkbox" name="$escapedFieldId" checked $fieldDisabled/>
                                        #else
                                        <input class="$required" id="$escapedFieldId" type="checkbox" name="$escapedFieldId" onchange="hideCheckboxRequired(this)" $fieldDisabled/>
                                        #end
                                        $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                        <div class="icon"></div>
                                    </div>
                                </label>
                                

                                #elseif( $field.getName() == "Checkbox Group" )
                                <div class="ping-checkbox-group-container">
                                    <div class="error-text ping-alert" id="required-$escapedFieldId">
                                        <span class="icon-alert"></span>
                                        $templateMessages.getMessage($messageKeyPrefix, "missingCheckboxGroup")
                                    </div>
                                    <div class="ping-input-label detached">
                                        $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                    </div>
                                    #foreach( $option in $field.getData().getOptions() )
                                    <label>
                                        <div class="ping-checkbox-container stacked $required">
                                            #if( $fieldValue.contains($option) )
                                            <input class="$required" type="checkbox" name="$escapedFieldId" value="$option" checked $fieldDisabled/>
                                            #else
                                            <input class="$required" type="checkbox" name="$escapedFieldId" value="$option" onchange="hideCheckboxRequired(this)" $fieldDisabled/>
                                            #end
                                            $option
                                            <div class="icon"></div>
                                        </div>
                                    </label>
                                    #end
                                </div>

                                #elseif( $field.getName() == "Email" )
                                <div class="ping-input-label">
                                    $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                </div>
                                    #if($fieldId == $emailVerifyFieldId)
                                <div class="ping-input-container input-controls $required" id="container-$escapedFieldId">
                                    <div class="inline-confirmation">
                                        <div class="icon-approve" id="icon-email-verification"></div>
                                        <div class="confirmation-text" id="email-verification-text">$templateMessages.getMessage($messageKeyPrefix, "emailAddressVerified")</div>
                                    </div>
                                    #else
                                <div class="ping-input-container $required" id="container-$escapedFieldId">
                                    #end
                                    <input class="$required $validateRequired" id="$escapedFieldId" type="email" autocomplete="off" name="$escapedFieldId" value="$fieldValue" size="36" onkeyup="return postOnReturn(event)" $fieldDisabled/>
                                </div>

                                #elseif( $field.getName() == "Phone" )
                                <div class="ping-input-label">
                                    $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                </div>
                                <div class="ping-input-container $required" id="container-$escapedFieldId">
                                    <input class="$required $validateRequired" id="$escapedFieldId" type="tel" autocomplete="off" name="$escapedFieldId" value="$fieldValue" size="36" onkeyup="return postOnReturn(event)" $fieldDisabled/>
                                </div>

                                #elseif( $field.getName() == "Dropdown" )
                                <span class="ping-input-label detached">
                                        $templateMessages.getMessageWithDefault($messageKeyPrefix, "$fieldId", "$field.getData().getLabel()")
                                    </span>
                                <label class="input-select ping-input-container $required $fieldDisabled" id="container-$escapedFieldId">
                                    <div class="input-container">
                                        <div class="wrapper">
                                            <select id="$escapedFieldId" name="$escapedFieldId" class="$required $validateRequired" onkeyup="return postOnReturn(event)" $fieldDisabled>
                                                #if($field.getData().getDefaultValue().equals(""))
                                                <option selected $disabledSelect value="">$templateMessages.getMessage($messageKeyPrefix, "dropDownDefault")</option>
                                                #end
                                                #foreach( $option in $field.getData().getOptions() )
                                                    #if( $option.equals($fieldValue)) )
                                                    <option selected value="$option">$option</option>
                                                    #else
                                                    <option value="$option">$option</option>
                                                    #end
                                                #end
                                            </select>
                                        </div>
                                    </div>
                                </label>
                                #end
                            <!-- </div> -->
                            <!-- content-column -->
                            #if($count == 0)
                        <!-- </div> -->
                        <!-- content-columns columns-2-->
                        #end
                        #end
                        ##Finish off the columns div if we have an odd number of fields
                        #if($count == 1)
                            <!-- </div> -->
                        <!-- content-columns columns-2-->
                        #end
            <!--            <textarea name="privacy" rows="6" cols="75">
                            Please read the ESS Privacy and Cookies Policies https://europeanspallationsource.se/privacy and check the box if you agree 
                        </textarea>  -->
                <!-- </div> -->
                <!-- end section 1 -->

                <div class="content-column">
                    <div class="section">
                        <div class="section-title">
                            $templateMessages.getMessage($messageKeyPrefix, "accountSettingsTitle")
                        </div>

                        #if($hasLocalIdentity)
                        <div class="your-account-container">
                            <input type="hidden" name="$changepass" value=""/>
                            ##Pop up the tooltip if there is an error message to show.
                            #if($passwordMessage)
                                #if($socialConnections.size() > 0)
                                    #set( $class = "details-tooltip top center show" )
                                #else
                                    #set( $class = "details-tooltip top right show" )
                                #end
                            #else
                                #if($socialConnections.size() > 0)
                                    #set( $class = "details-tooltip top center" )
                                #else
                                    #set( $class = "details-tooltip top right" )
                                #end
                            #end

                            <span class="$class">
                                    <a onclick="showTooltip(this); focusCurrentPasswordField();" class="cancel" title="$templateMessages.getMessage($messageKeyPrefix, "changePasswordTitle")">
                                        $templateMessages.getMessage($messageKeyPrefix, "changePasswordTitle")
                                </a>
                                <div class="details-content" id="change-password-tooltip">
                                        <div class="details-content-inner">
                                            <span class="details-close" onclick="hideTooltip()">

                                            </span>
                                            <div class="details-title">
                                                $templateMessages.getMessage($messageKeyPrefix, "changePasswordTitle")
                                            </div>
                                            <div class="details-body">
                                                #if($passwordMessage)
                                                <div class="ping-messages">
                                                    <div class="ping-error">$templateMessages.getMessage($passwordMessage.getMessageKey(), $passwordMessage.getParams())</div>
                                                </div>
                                                #end

                                                <span class="ping-messages" style="display:none" id="required-password-field-error">
                                                    <div class="ping-error">
                                                        <span class="icon-alert"></span>
                                                        $templateMessages.getMessage($messageKeyPrefix, "required.fields.missing")
                                                    </div>
                                                </span>

                                                <div class="ping-input-label">
                                                    $templateMessages.getMessage($messageKeyPrefix, "currentPasswordTitle")
                                                </div>
                                                <div class="ping-input-container required" id="container-currentPassword">
                                                    <input id="currentPassword" class="pass-required" type="password" name="$currentPass" autocomplete="off" onKeyUp="return postChangePassOnReturn(event)" />
                                                </div>

                                                <div class="ping-input-container">
                                                    <div class="place-top type-requirements requirements tooltip-text" id="password-requirements">
                                                        <div class="title" onclick="showHideRequirements();">
                                                            $templateMessages.getMessage($messageKeyPrefix, "passwordRequirementTitle")
                                                        </div>
                                                        <div class="requirements-text">
                                                            <div class="requirements-contain">
                                                                $templateMessages.getMessage($messageKeyPrefix, "passwordRequirementsContain")
                                                            </div>
                                                            <div>
                                                                Minimum 12 Characters
                                                            </div>
                                                            <div>
                                                                At least One Lower Case
                                                            </div>
                                                            <div>
                                                                At least One Upper Case
                                                            </div>
                                                            <div>
                                                                At least One Special Character (~\!@\#$%^&*_-+\=`|(){}[]\:;"'<>,.?/)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="ping-input-label">
                                                    $templateMessages.getMessage($messageKeyPrefix, "newPasswordTitle")
                                                </div>
                                                <div class="ping-input-container required" id="container-password">
                                                    <input id="password" class="pass-required reveal" type="password" name="$pass" autocomplete="user-password" onKeyUp="return postChangePassOnReturn(event)" />
                                                    <a id="reveal" class="password-show-button icon-view" onclick="revealPassword();"></a>
                                                </div>
                                                <div class="button-group">
                                                    <button type="button" onclick="return postChangePass();" class="primary">$templateMessages.getMessage($messageKeyPrefix, "changePasswordButtonTitle")</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                        </div>
                        <!-- your-account-container -->
                        #end

                        #if(!$hasLocalIdentity)
                        <div class="your-account-container">
                            <input type="hidden" name="$setpass" value=""/>
                            ##Pop up the tooltip if there is an error message to show.
                            #if($passwordMessage)
                            #if($socialConnections.size() > 0)
                            #set( $class = "details-tooltip top center show" )
                            #else
                            #set( $class = "details-tooltip top right show" )
                            #end
                            #else
                            #if($socialConnections.size() > 0)
                            #set( $class = "details-tooltip top center" )
                            #else
                            #set( $class = "details-tooltip top right" )
                            #end
                            #end

                            <span class="$class">
                                    <a onclick="showTooltip(this); focusNewPasswordField();" class="cancel" title="$templateMessages.getMessage($messageKeyPrefix, "setPasswordTitle")">
                                        $templateMessages.getMessage($messageKeyPrefix, "setPasswordTitle")
                                </a>
                                <div class="details-content" id="change-password-tooltip">
                                        <div class="details-content-inner">
                                            <span class="details-close" onclick="hideTooltip()">

                                            </span>
                                            <div class="details-title">
                                                $templateMessages.getMessage($messageKeyPrefix, "setPasswordTitle")
                                            </div>
                                            <div class="details-body">
                                                #if($passwordMessage)
                                                <div class="ping-messages">
                                                    <div class="ping-error">$templateMessages.getMessage($passwordMessage.getMessageKey(), $passwordMessage.getParams())</div>
                                                </div>
                                                #end

                                                <span class="ping-messages" style="display:none" id="required-password-field-error">
                                                    <div class="ping-error">
                                                        <span class="icon-alert"></span>
                                                        $templateMessages.getMessage($messageKeyPrefix, "required.fields.missing")
                                                    </div>
                                                </span>

                                                <div class="ping-input-container">
                                                    <div class="place-top no-border type-requirements requirements tooltip-text" id="password-requirements">
                                                        <div class="title" onclick="showHideRequirements();">
                                                            $templateMessages.getMessage($messageKeyPrefix, "passwordRequirementTitle")
                                                        </div>
                                                        <div class="requirements-text">
                                                            <div class="requirements-contain">
                                                                $templateMessages.getMessage($messageKeyPrefix, "passwordRequirementsContain")
                                                            </div>
                                                            <div>
                                                                Minimum 12 Characters
                                                            </div>
                                                            <div>
                                                                At least One Lower Case
                                                            </div>
                                                            <div>
                                                                At least One Upper Case
                                                            </div>
                                                            <div>
                                                                At least One Special Character (~\!@\#$%^&*_-+\=`|(){}[]\:;"'<>,.?/)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="ping-input-label">
                                                    $templateMessages.getMessage($messageKeyPrefix, "newPasswordTitle")
                                                </div>
                                                <div class="ping-input-container required" id="container-password">
                                                    <input id="password" class="pass-required reveal" type="password" name="$pass" autocomplete="user-password" onKeyUp="return postSetPassOnReturn(event)" />
                                                    <a id="reveal" class="password-show-button icon-view" onclick="revealPassword();"></a>
                                                </div>
                                                <div class="button-group">
                                                    <button type="button" onclick="return postSetPass();" class="primary">$templateMessages.getMessage($messageKeyPrefix, "setPasswordButtonTitle")</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                        </div>
                        #end

                        <!--#if($displayDelete)
                        <div class="your-account-container">

                            #if($socialConnections.size() > 0)
                                #set( $tooltipClass = "details-tooltip top center" )
                            #else
                                #set( $tooltipClass = "details-tooltip top right" )
                            #end

                                <span class="$tooltipClass">

                                    <a href="javascript:void(0)" onclick="showTooltip(this)" class="cancel" title='$templateMessages.getMessage($messageKeyPrefix, "deleteAccountPopupTitle")'>
                                    $templateMessages.getMessage($messageKeyPrefix, "deleteAccountPopupTitle")
                                    </a>
                                    <div class="details-content">
                                        <div class="details-content-inner">
                                            <span class="details-close" onclick="hideTooltip()">

                                            </span>
                                            <div class="details-title">
                                                $templateMessages.getMessage($messageKeyPrefix, "deleteAccountButtonTitle")
                                            </div>
                                            <div class="details-body">
                                                <p>$templateMessages.getMessage($messageKeyPrefix, "deleteWarning")</p>
                                                <div class="button-group">
                                                    <button type="button" onclick="postDelete();" class="primary delete">$templateMessages.getMessage($messageKeyPrefix, "deleteButtonTitle")</button>
                                                    <br>
                                                    <a class="cancel" onclick="hideTooltip();">$templateMessages.getMessage($messageKeyPrefix, "cancelButtonTitle")</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                        </div>-->
                        #end
                        <!-- end display-delete -->
                   <!-- </div>

                </div>
                #if($socialConnections.size() > 0)
            </div> -->
            #end
        </div>
        <!-- sections -->

        ## delete 'right' to center align buttons
        <div class="ping-buttons ">
            <input type="hidden" name="cSRFToken" value="$cSRFToken">
            <input type="hidden" name="$save" value=""/>
            <input type="hidden" name="$logout" value=""/>
            <input type="hidden" name="$delete" value=""/>

            <a href="javascript:void(0)" onclick="postLogout();" class="ping-button secondary" title='$templateMessages.getMessage($messageKeyPrefix, "logoutButtonTitle")'>
                $templateMessages.getMessage($messageKeyPrefix, "logoutButtonTitle")
            </a>

            <a onclick="postSave();" class="ping-button normal allow" title='$templateMessages.getMessage($messageKeyPrefix, "saveButtonTitle")'>
                $templateMessages.getMessage($messageKeyPrefix, "saveButtonTitle")
            </a>
            <div>
	            <a onclick="showPrivacyStatement()" id="privacyStamentLink">Privacy Statement</a>
            </div>
            <div>
            <a href="javascript:void(0)" onclick="showHelp();" title="Help">
                    Help
                </a>
            </div>
        </div>

        </form>
    </div>
    <!-- .ping-body/ blank -->
</div>
<!-- .ping-body-container -->

<div class="ping-footer-container">
    <div class="ping-footer">
        <div class="ping-copyright">$templateMessages.getMessage("global.footerMessage")</div>
    </div>
    <!-- .ping-footer -->
</div>
<!-- .ping-footer-container -->

</div>
<!-- .ping-container -->

<script type="text/javascript">

    function showHideRequirements() {
        var tips = document.getElementById('password-requirements');

        if (tips.className.search(/\bopen\b/) === -1) {
            tips.className += ' open';
        }
        else {
            tips.className = tips.className.replace(/\bopen\b/,'');
        }
    }

	var variants = ["Biometrics", "Windows Hello", "Face ID",  "Touch ID"];

    function postDisconnect(id) {
	    if(variants.indexOf(id) >= 0) id = "FIDO";
        document.forms[0]['$disconnect'].value = id;
        document.forms[0].submit();
    }

    function postConnect(id) {
	    if(variants.indexOf(id) >= 0) id = "FIDO";
        document.forms[0]['$connect'].value = id;
        document.forms[0].submit();
    }

    function postSendEmailVerification() {
        document.forms[0]['$sendEmailVerification'].value = 'clicked';
        document.forms[0].submit();
    }

    function postSave() {
        if (!requiredFieldsMissing()) {
            // run browser validation
            if(document.forms[0].checkValidity && !document.forms[0].checkValidity() && document.forms[0].reportValidity) {
                document.forms[0].reportValidity();
                return false;
            }
            document.forms[0]['$save'].value = 'clicked';
            document.forms[0].submit();
        }
    }

    function revealPassword() {
        if (document.getElementById('password').type === 'password') {
            var inputType = document.getElementById("password");
            inputType.setAttribute('type', 'text');

            document.getElementById('reveal').className = 'password-show-button icon-view-hidden';
        }
        else {
            var inputType = document.getElementById("password");
            inputType.setAttribute('type', 'password');

            document.getElementById('reveal').className = 'password-show-button icon-view';
        }
    }

    function requiredFieldsMissing() {
        var requiredFields = document.querySelectorAll("input.required,select.required");
        var foundMissingField = false;

        for (var i = 0; i < requiredFields.length; i++) {
            var field = requiredFields[i];
            if (field.type === "checkbox")
                foundMissingField = isCheckBoxFieldMissing(field) || foundMissingField;
            else if (field.tagName === 'SELECT')
                foundMissingField = isSelectFieldMissing(field) || foundMissingField;
            else if (field.name === 'mail')
                foundMissingField = isEmailFieldMissing(field) || foundMissingField;
            else
                foundMissingField = isStandardFieldMissing(field) || foundMissingField;
        }

        if (foundMissingField) {
            var element = document.getElementById("required-field-error");
            element.style.display = "block";
            window.scroll(0, element.offsetTop);
        }
        else {
            document.getElementById("required-field-error").style.display = "none";
        }
        return foundMissingField;
    }

    function isCheckBoxFieldMissing(field) {
        var checkboxes = document.getElementsByName(field.name);
        var foundChecked = false;

        for (var i = 0; i < checkboxes.length; i++) {
            if(checkboxes[i].checked) {
                foundChecked = true;
            }
        }

        if (!foundChecked) {
            // Use the name if no id is provided (for check box groups)
            var errorField = document.getElementById("required-" + checkboxes[0].name);
            errorField.classList.add("show");
        }
        return !foundChecked;
    }

    function hideCheckboxRequired(field){
        var id = field.name;
        var requiredDisplay  = document.getElementById("required-" + id);
        requiredDisplay.classList.remove("show");
    }

    function isSelectFieldMissing(field) {
        if (field.tagName === 'SELECT' && field.selectedIndex === 0 && field.options[0].disabled) {
            showErrorDisplay(field);
            return true;
        }
        return false;
    }

    function isEmailFieldMissing(field) {
        // Regular expression to match a valid email format
        var emailRegex = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
    
        if (!emailRegex.test(field.value)) {
            showErrorDisplay(field);
            return true;
        }
    
        return false;
    }

    function isStandardFieldMissing(field){
        if (!field.value) {
            showErrorDisplay(field);
            return true;
        }
        return false;
    }

    function showErrorDisplay(field) {
        var container = document.getElementById("container-" + field.id);
        container.classList.add("error");
        container.classList.add("form-error");
        container.classList.add("required");
    }

    function showRequiredDisplay(field) {
        var container = document.getElementById("container-" + field.id);
        container.classList.add("required");
    }

    function removeRequiredDisplay(field) {
        var container = document.getElementById("container-" + field.id);
        container.classList.remove("error");
        container.classList.remove("form-error");
        container.classList.remove("required");
    }

    function toggleRequiredDisplay(field) {
        if(!field.value || field.value === "")
            showRequiredDisplay(field);
        else
            removeRequiredDisplay(field);
    }

    function postChangePass() {
        var currPass = document.getElementById("currentPassword");
        var newPass = document.getElementById("password");

        if(isStandardFieldMissing(currPass) | isStandardFieldMissing(newPass)){
            document.getElementById("required-password-field-error").style.display = "block";
            return false;
        }
        else {
            document.forms[0]['$changepass'].value = 'clicked';
            document.forms[0].submit();
        }
    }

    function postSetPass() {
        var newPass = document.getElementById("password");

        if(isStandardFieldMissing(newPass)){
            document.getElementById("required-password-field-error").style.display = "block";
            return false;
        }
        else {
            document.forms[0]['$setpass'].value = 'clicked';
            document.forms[0].submit();
        }
    }

    function postDelete() {
        document.forms[0]['$delete'].value = 'clicked';
        document.forms[0].submit();
    }

    function postLogout() {
        document.forms[0]['$logout'].value = 'clicked';
        document.forms[0].submit();
    }

    function showPrivacyStatement() {
     document.getElementById("privacyStatementOverlay").style.display = "block";
    }

    function hidePrivacyStatement() {
       document.getElementById("privacyStatementOverlay").style.display = "none";
    }


    function postChangePassOnReturn(e) {
        removeRequiredDisplay(e);

        var keycode;
        if (window.event) keycode = window.event.keyCode;
        else if (e) keycode = e.which;
        else return true;

        if (keycode == 13) {
            postChangePass();
            return false;
        } else {
            return true;
        }
    }

    function postSetPassOnReturn(e) {
        removeRequiredDisplay(e);

        var keycode;
        if (window.event) keycode = window.event.keyCode;
        else if (e) keycode = e.which;
        else return true;

        if (keycode == 13) {
            postSetPass();
            return false;
        } else {
            return true;
        }
    }

    function postOnReturn(e) {
        var keycode;
        if (window.event) keycode = window.event.keyCode;
        else if (e) keycode = e.which;
        else return true;

        if (keycode == 13) {
            postOk();
            return false;
        } else {
            return true;
        }
    }

    function hideTooltip(){
        var tooltips = document.getElementsByClassName("details-tooltip");
        for (var i = 0; i < tooltips.length; i++) {
            tooltips[i].className = tooltips[i].className.replace("show", "");
        }
    }

    function showTooltip(element) {
        hideTooltip();
        element.parentElement.className += ' show';
    }

    function setMobile(mobile, agent) {
        var className = ' mobile',
            agentClass = agent,
            hasClass = (bodyTag.className.indexOf(className) !== -1),
            hasAgent = (bodyTag.className.indexOf(agentClass) !== -1);

        if (mobile && !hasClass) {
            bodyTag.className += className;
            bodyTag.className += agentClass;
        } else if (!mobile && hasClass) {
            bodyTag.className = bodyTag.className.replace(className, '');
        } else if (!mobile && hasAgent) {
            bodyTag.className = bodyTag.className.replace(agentClass, '');
        }
    }
    
    function setNarrow(narrow) {
        var className = ' narrow',
            hasClass = (bodyTag.className.indexOf(className) !== -1);

        if (narrow && !hasClass) {
            bodyTag.className += className;
        } else if (!narrow && hasClass) {
            bodyTag.className = bodyTag.className.replace(className, '');
        }
    }

    function getScreenWidth() {
        return (window.outerHeight) ? window.outerWidth : document.body.clientWidth;
    }

    var bodyTag = document.getElementsByTagName('body')[0],
        width = getScreenWidth(),
        userAgent = '';
    if (navigator.userAgent.toLowerCase().match(/android/i)) {
        userAgent = ' device-android';
    }
    if (/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        setMobile(true, userAgent);
    } else {
        setMobile((width <= 480), userAgent);
        setNarrow((width <= 900));
        window.onresize = function() {
            width = getScreenWidth();
            setMobile((width <= 480), userAgent);
            setNarrow((width <= 900));
        }
    }

    // check width for details tooltips (300px w)
    var leftPosition;
    function getTooltipSizing(mobile) {
        var tooltips = document.getElementsByClassName('details-content');
        // divide by 4 instead of 2 to account for marginLeft of 36px
        leftPosition = 'left: ' + (width - 300)/ 4 + 'px';
        for (i = 0; i < tooltips.length; i++) {
            if (mobile || narrow) {
                tooltips[i].style.cssText = leftPosition;
            }
            else {
                tooltips[i].style.cssText = '';
            }
        }
    }
    // if (width <= 480) {
    if (width <= 900) {
        getTooltipSizing(true);
        window.onresize = function() {
            width = getScreenWidth();
            // getTooltipSizing(width <= 480);
            getTooltipSizing(width <= 900);
        }
    }

    #if($passwordMessage)
        if (/iPhone|iPod/i.test(navigator.userAgent)) {
            var tooltip = document.getElementById('change-password-tooltip');
            tooltip.scrollIntoView();
        }
        else {
            document.getElementById('currentPassword').focus();
        }
    #end

    const requiredElements = document.forms[0].querySelectorAll('.required-missing-display,.pass-required');
    for (i = 0; i < requiredElements.length; i++) {
        var requiredElement = requiredElements[i];
        requiredElement.addEventListener('keyup', function (event) {
            toggleRequiredDisplay(event.target);
        });
        requiredElement.addEventListener('change', function (event) {
            toggleRequiredDisplay(event.target);
        });

        if (requiredElement.tagName === 'SELECT') {
            if(requiredElement.tagName === 'SELECT' && requiredElement.selectedIndex !== 0 && !requiredElement.options[0].disabled)
                removeRequiredDisplay(requiredElement);
        } else {
            if(requiredElement.value) {
                removeRequiredDisplay(requiredElement);
            }
        }
    }

    function clearMessage(element, timeout) {
        setTimeout(function () {
            element.style.display = 'none'
        }, timeout);
    }

    function showMessage(element, timeout) {
        setTimeout(function () {
            element.style.display = 'block'
        }, timeout);
    }

    function focusCurrentPasswordField() {
        document.getElementById('currentPassword').focus();
    }

    function focusNewPasswordField() {
        document.getElementById('password').focus();
    }

    const messages = document.querySelectorAll('.page-messages .message');
    for (i = 0; i < messages.length; i++) {
        showMessage(messages[i], 250 * i);
    }

    // hide messages after 5 seconds.
    setInterval(function(){
        const messages = document.querySelectorAll('.page-messages .message');
        for (var i = 0; i < messages.length; i++) {
            clearMessage(messages[i], 750 * i);
        }
    }, 5000);

    const closebuttons = document.querySelectorAll('.page-messages .message > a.close');
    // attach listener to remove message when close button is clicked.
    for (i = 0; i < closebuttons.length; i++) {
        var element = closebuttons[i];
        element.addEventListener('click', function (event) {
            var messagediv = event.target.parentNode;
            messagediv.parentNode.removeChild(messagediv);
        })
    }

    if (document.getElementById('icon-email-verification')) {
        // attach hover event to email verification
        var emailVerification = document.getElementById('icon-email-verification');
        emailVerification.addEventListener('mouseover', function( event ) {
            document.getElementById('email-verification-text').className = 'confirmation-text show';
            // reset the class after 3 seconds
            setTimeout(function() {
                document.getElementById('email-verification-text').className = 'confirmation-text';
            }, 3000);
        }, false);
    }

    function IsWebAuthnSupported() {
        if (!window.PublicKeyCredential) {

            console.log("Web Authentication API is not supported on this browser.");
            return false;
        }

        return true;
    }

    function isWebAuthnPlatformAuthenticatorAvailable() {

        theElement = document.getElementById("biometrics-div");
        if(theElement)
            theElement.style.display = "none";

        theElement = document.getElementById("windowshello-div");
        if(theElement)
             theElement.style.display = "none";

        theElement = document.getElementById("faceid-div");
        if(theElement)
            theElement.style.display = "none";

        theElement = document.getElementById("touchid-div");
        if(theElement)
            theElement.style.display = "none";

        // skip the WebAuthn support check on Internet Explorer as both WebAuthn and Promise are not supported on IE
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
            return false;
        }

        var timer;

        var p1 = new Promise(function(resolve) {
            timer = setTimeout(function() {
                console.log("isWebAuthnPlatformAuthenticatorAvailable - Timeout");
                resolve(false);
            }, 300);
        });

        var p2 = new Promise(function(resolve) {

            if (IsWebAuthnSupported() && window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable) {

                resolve(
                    window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().catch(function(err) {
                        console.log(err);
                        return false;
                    }));
            }
            else {
                resolve(false);
            }
        });

        return Promise.race([p1, p2]).then(function (res) {
            clearTimeout(timer);
            console.log("isWebAuthnPlatformAuthenticatorAvailable - " +  res);

            if(res) {
                 theElement = document.getElementById("biometrics-div");
                 if(theElement)
                     theElement.style.display = "block";

                 theElement = document.getElementById("windowshello-div");
                 if(theElement)
                     theElement.style.display = "block";

                 theElement = document.getElementById("faceid-div");
                 if(theElement)
                     theElement.style.display = "block";

                 theElement = document.getElementById("touchid-div");
                 if(theElement)
                     theElement.style.display = "block";
            }

            return res;
        });
    }
</script>
</body>
</html>
